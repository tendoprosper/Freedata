<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AGRICOM | Cart & Checkout</title>
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script> <!-- PayPal Sandbox -->
<style>
/* ===== RESET ===== */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif}

/* ===== BACKGROUND ===== */
body{
color:#fff;
background:linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.65)),
url("https://images.unsplash.com/photo-1501004318641-b39e6451bec6");
background-size:cover;background-attachment:fixed;background-position:center;
}

/* ===== NAVBAR ===== */
nav{
background:rgba(0,0,0,.7);
backdrop-filter:blur(14px);
padding:18px 8%;
display:flex;
justify-content:space-between;
align-items:center;
position:sticky;
top:0;
z-index:100;
border-bottom:2px solid #2ecc71;
}
nav h1{color:#2ecc71;letter-spacing:4px;font-size:26px}
nav ul{list-style:none;display:flex;gap:25px}
nav ul a{color:#fff;text-decoration:none;position:relative;padding-bottom:5px}
nav ul a:hover{color:#2ecc71}

/* ===== CART CONTAINER ===== */
#cart-container{padding:40px 8%;}
#cart-container h2{color:#2ecc71;margin-bottom:20px;text-align:center;font-size:28px}
.cart-item{display:flex;justify-content:space-between;align-items:center;margin:10px 0;background:rgba(255,255,255,.1);padding:15px;border-radius:12px;flex-wrap:wrap}
.cart-item div{margin:5px 0}
.cart-item img{width:80px;height:80px;object-fit:cover;border-radius:10px}
.cart-item input[type=number]{width:50px;padding:5px;margin-left:5px;border-radius:5px;border:none;outline:none}
.cart-item button{background:#e74c3c;color:#fff;border:none;padding:6px 12px;border-radius:10px;cursor:pointer;margin-left:5px}
#total{margin-top:20px;font-weight:bold;font-size:20px;text-align:right}

/* ===== CUSTOMER DETAILS ===== */
.customer-details{margin-top:30px;background:rgba(255,255,255,.12);padding:20px;border-radius:15px;backdrop-filter:blur(12px);max-width:400px}
.customer-details input{width:100%;padding:10px;margin:10px 0;border-radius:10px;border:none;outline:none}
.customer-details label{opacity:.8}

/* ===== CHECKOUT BUTTONS ===== */
.checkout-buttons{margin-top:20px;display:flex;flex-wrap:wrap;gap:15px}
.checkout-buttons button{flex:1;padding:12px;background:#2ecc71;border:none;border-radius:15px;color:#000;font-weight:bold;cursor:pointer}
.checkout-buttons button:hover{background:#27ae60}
#paypal-button-container{margin-top:20px}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav>
<h1>AGRICOM</h1>
<ul>
<li><a href="green.html">Home</a></li>
<li><a href="buy.html">Buy Fresh</a></li>
</ul>
</nav>

<!-- CART CONTENT -->
<div id="cart-container">
<h2>Your Cart</h2>
<div id="cart-items"></div>
<div id="total"></div>

<div class="customer-details">
<label for="custName">Your Name</label>
<input type="text" id="custName" placeholder="Enter your name">
<label for="custPhone">Phone Number</label>
<input type="text" id="custPhone" placeholder="Enter your phone number">
</div>

<div class="checkout-buttons">
<button onclick="checkoutWhatsApp()">Checkout via WhatsApp</button>
</div>

<div id="paypal-button-container"></div>
</div>

<script>
// LOAD CART FROM LOCALSTORAGE
function updateCart(){
let cart=JSON.parse(localStorage.getItem("cart"))||[];
const container=document.getElementById("cart-items");
container.innerHTML="";
let total=0;
cart.forEach((item,i)=>{
total+=item.price*item.quantity;
container.innerHTML+=`
<div class="cart-item">
<img src="${item.img}">
<div>${item.name} (${item.farmer})</div>
<div>UGX ${item.price}</div>
<div>
<label>Qty: </label>
<input type="number" min="1" value="${item.quantity}" onchange="changeQty(${i},this.value)">
</div>
<button onclick="removeItem(${i})">Remove</button>
</div>
`;
});
document.getElementById("total").innerHTML="Total: UGX "+total;
}
updateCart();

// QUANTITY CHANGE
function changeQty(i,v){
let cart=JSON.parse(localStorage.getItem("cart"));
cart[i].quantity=parseInt(v);
localStorage.setItem("cart",JSON.stringify(cart));
updateCart();
}

// REMOVE ITEM
function removeItem(i){
let cart=JSON.parse(localStorage.getItem("cart"));
cart.splice(i,1);
localStorage.setItem("cart",JSON.stringify(cart));
updateCart();
}

// WHATSAPP CHECKOUT
function checkoutWhatsApp(){
let cart=JSON.parse(localStorage.getItem("cart"))||[];
if(cart.length===0){alert("Cart empty"); return;}
let name=document.getElementById("custName").value.trim();
let phone=document.getElementById("custPhone").value.trim();
if(name===""||phone===""){alert("Please enter name and phone number");return;}
let msg=`Hello, my name is ${name}, phone: ${phone}. I want to order:%0A`;
cart.forEach(i=>{
msg+=`${i.name} x${i.quantity} - UGX ${i.price*i.quantity}%0A`;
});
let total=cart.reduce((sum,i)=>sum+i.price*i.quantity,0);
msg+="Total: UGX "+total;
window.open("https://wa.me/256702640109?text="+msg,"_blank");
}

// PAYPAL INTEGRATION
paypal.Buttons({
createOrder: function(data, actions) {
let cart=JSON.parse(localStorage.getItem("cart"))||[];
let total=cart.reduce((sum,i)=>sum+i.price*i.quantity,0)/3800; // UGX -> USD approx
return actions.order.create({purchase_units:[{amount:{value:total.toFixed(2)}}]});
},
onApprove: function(data, actions) {
return actions.order.capture().then(function(details){
alert("Payment completed by "+details.payer.name.given_name);
localStorage.removeItem("cart");
updateCart();
});
}
}).render('#paypal-button-container');
</script>
</body>
</html>
